---
title: "Telco Project"
author: "Rami"
date: "May 20, 2016"
output: html_document
---

# Setup

```{r}
# options( java.parameters = "-Xmx12g" )
# library(MASS)
library(dplyr)
library(knitr)
# library(reshape2)
library(caret)
# library(FactoMineR)
# library(corrplot)
# library(e1071)
# library(randomForest)
# Let's not thrash my SSD to death for the sake of this project..
# library(doMC)
# registerDoMC(cores = 3)
```

```{r}
train <- read.csv("engineered.train.csv")
test <- read.csv("engineered.test.csv")
train$TARGET <- factor(train$TARGET)
levels(train$TARGET) <- c("Negative", "Positive")
```

```{r}
export_res <- function (res, fname) {
  dframe <- cbind(as.integer(test$CONTRACT_KEY), as.integer(res) - 1) %>% data.frame
  names(dframe) <- c("CONTRACT_KEY", "PREDICTED_TARGET")
  dframe$CONTRACT_KEY <- as.integer(dframe$CONTRACT_KEY)
  dframe$PREDICTED_TARGET <- as.integer(dframe$PREDICTED_TARGET)
  write.csv(dframe, fname, row.names = FALSE, quote = FALSE)
}
```


# Partial Least Squares

```{r}
set.seed(1337)
model.pls2 <- plsda(select(train, -CONTRACT_KEY, -TARGET),
                    train$TARGET,
                    probMehod = "Bayes",
                    na.action = na.pass,
                    ncomp = 13)
```

```{r}
set.seed(1337)
alternate_train <- downSample(select(train, -CONTRACT_KEY, -TARGET), train$TARGET, yname = "TARGET")
model.pls <- train(TARGET ~ .,
                   alternate_train,
                   method = "pls",
                   tuneGrid = expand.grid(.ncomp = 10:20),
                   probMehod = "Bayes",
                   metric = "ROC",
                   na.action = na.pass,
                   trControl = trainControl(
                     #method = "cv",
                     number = 2,
                     classProbs = TRUE,
                     savePredictions = TRUE,
                     summaryFunction = twoClassSummary),
                   verbose = TRUE)
model.pls
confusionMatrix(model.pls)
```

```{r}
set.seed(1337)
alternate_train <- upSample(select(train, -CONTRACT_KEY, -TARGET), train$TARGET, yname = "TARGET")
model.pls <- train(TARGET ~ .,
                   alternate_train,
                   method = "pls",
                   tuneGrid = expand.grid(.ncomp = 10:20),
                   probMehod = "Bayes",
                   metric = "ROC",
                   na.action = na.pass,
                   trControl = trainControl(
                     #method = "cv",
                     number = 2,
                     classProbs = TRUE,
                     savePredictions = TRUE,
                     summaryFunction = twoClassSummary),
                   verbose = TRUE)
model.pls
confusionMatrix(model.pls)
```

```{r}
pred.pls <- predict(model.pls, newdata = test)
summary(pred.pls)
```

# RPART

```{r}
set.seed(1337)
model.rpart <- train(x = select(train, -c(TARGET, CONTRACT_KEY)),
                     y = train$TARGET,
                     method = "rpart",
                     tuneLength = 30,
                     trControl = trainControl(
                       method = "cv",
                       number = 10,
                       classProbs = TRUE,
                       savePredictions = TRUE,
                       summaryFunction = twoClassSummary),
                     metric = "Spec")
model.rpart
```

```{r}
pred.rpart <- predict(model.rpart, newdata = test)
summary(pred.rpart)
```

# Neural Network

# Discriminant Analysis

```{r}
model.qda <- qda(TARGET ~ ., data = train)
```

# Random Forest

Do MCA..
