---
title: "Telco Project"
author: "Rami"
date: "May 20, 2016"
output: html_document
---

# Setup

```{r}
# options( java.parameters = "-Xmx12g" )
# library(MASS)
library(dplyr)
library(knitr)
# library(reshape2)
library(caret)
# library(FactoMineR)
# library(corrplot)
# library(e1071)
# library(randomForest)
# Let's not thrash my SSD to death for the sake of this project..
# library(doMC)
# registerDoMC(cores = 3)
```

```{r}
train <- read.csv("engineered.train.csv")
test <- read.csv("engineered.test.csv")
train$TARGET <- factor(train$TARGET)
levels(train$TARGET) <- c("Negative", "Positive")
```

```{r}
export_res <- function (res, fname) {
  dframe <- cbind(as.integer(test$CONTRACT_KEY), as.integer(res) - 1) %>% data.frame
  names(dframe) <- c("CONTRACT_KEY", "PREDICTED_TARGET")
  dframe$CONTRACT_KEY <- as.integer(dframe$CONTRACT_KEY)
  dframe$PREDICTED_TARGET <- as.integer(dframe$PREDICTED_TARGET)
  write.csv(dframe, fname, row.names = FALSE, quote = FALSE)
}
```


# Partial Least Squares

```{r}
set.seed(1337)
alternate_train <- downSample(select(train, -CONTRACT_KEY, -TARGET), train$TARGET, yname = "TARGET")
model.pls <- train(x = select(alternate_train, -TARGET),
                   y = alternate_train$TARGET,
                   method = "pls",
                   tuneGrid = expand.grid(.ncomp = 1:20),
                   probMehod = "Bayes",
                   metric = "ROC",
                   na.action = na.pass,
                   trControl = trainControl(
                     #method = "cv",
                     number = 5,
                     classProbs = TRUE,
                     savePredictions = TRUE,
                     summaryFunction = twoClassSummary),
                   verbose = TRUE)
model.pls
confusionMatrix(model.pls)
```

```{r}
pred.pls <- predict(model.pls, newdata = select(test, -CONTRACT_KEY))
summary(pred.pls)
```

# RPART

```{r}
set.seed(1337)
alternate_train <- upSample(select(train, -CONTRACT_KEY, -TARGET, -starts_with("PC")), train$TARGET, yname = "TARGET")
model.rpart <- train(x = select(alternate_train, -TARGET),
                     y = alternate_train$TARGET,
                     method = "rpart",
                     tuneLength = 10,
                     trControl = trainControl(
                       method = "cv",
                       number = 10,
                       classProbs = TRUE,
                       savePredictions = TRUE,
                       summaryFunction = twoClassSummary),
                     metric = "ROC")
model.rpart
confusionMatrix(model.rpart)
```

```{r}
pred.rpart <- predict(model.rpart, newdata = test)
summary(pred.rpart)
```

# Random Forest

```{r}
set.seed(1337)
alternate_train <- downSample(select(train, -CONTRACT_KEY, -TARGET), train$TARGET, yname = "TARGET")
model.rf <-    train(x = select(alternate_train, -TARGET),
                     y = alternate_train$TARGET,
                     method = "rf",
                     tuneLength = 1,
                     trControl = trainControl(
                       method = "boot",
                       number = 2,
                       classProbs = TRUE,
                       savePredictions = TRUE,
                       summaryFunction = twoClassSummary),
                     metric = "ROC")
model.rf
confusionMatrix(model.rf)
```

```{r}
pred.rf <- predict(model.rf, newdata = test)
summary(pred.rf)
```

# Neural Network

```{r}
set.seed(1337)
alternate_train <- downSample(select(train, -CONTRACT_KEY, -TARGET), train$TARGET, yname = "TARGET")
maxSize <- 2
numWts <- 2#maxSize * ncol(alternate_train) + maxSize + 1
model.nnet <- train(x = select(alternate_train, -TARGET),
                    y = alternate_train$TARGET,
                    method = "nnet",
                    metric = "ROC",
                    tuneGrid = expand.grid(.size = 1:maxSize,
                                           .decay = c(0, 0.1, 1, 2)),
                    #trace = FALSE,
                    maxit = 10,
                    MaxNWts = numWts,
                    trControl = trainControl(
                       #method = "cv",
                       number = 2,
                       classProbs = TRUE,
                       savePredictions = TRUE,
                       summaryFunction = twoClassSummary))
model.nnet
confusionMatrix(model.nnet)
```

```{r}
pred.nnet <- predict(model.nnet, newdata = test)
summary(pred.nnet)
```
# Discriminant Analysis

```{r}
model.qda <- qda(TARGET ~ ., data = train)
```

# Random Forest

Do MCA..
